<!-- Notification Permission Banner -->
<div 
  *ngIf="showNotificationPermissionBanner" 
  class="fixed bottom-4 right-4 z-50 bg-primary-adaptive text-dark p-4 rounded-lg shadow-lg flex items-center space-x-3 max-w-sm transform transition-all duration-300 ease-in-out"
  [class.translate-y-0]="showNotificationPermissionBanner"
  [class.translate-y-full]="!showNotificationPermissionBanner">
  <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
    <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path>
  </svg>
  <div class="flex-1">
    <p class="text-sm font-medium">Enable notifications to get event reminders</p>
  </div>
  <div class="flex items-center space-x-2">
    <button 
      (click)="requestNotificationPermission()"
      class="text-sm font-medium bg-dark text-primary-adaptive px-3 py-1 rounded hover:bg-dark/80 transition-colors">
      Enable
    </button>
    <button 
      (click)="dismissNotificationBanner()"
      class="text-dark hover:text-dark/70 transition-colors p-1"
      title="Dismiss">
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
      </svg>
    </button>
  </div>
</div>

<!-- Main Calendar Container -->
<div class="flex h-screen bg-themed-sidebar text-themed-primary">
  <!-- Sidebar -->
  <div class="w-80 bg-themed-sidebar border-r border-themed flex flex-col">
    <!-- Create Button -->
    <div class="p-6 border-b border-themed">
      <button 
        (click)="openCreateEventModal()"
        class="w-full bg-primary-adaptive text-dark px-6 py-3 rounded-full font-semibold hover:bg-primary-adaptive/90 transition-all duration-200 shadow-lg flex items-center justify-center space-x-2">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
        </svg>
        <span>Create</span>
      </button>
    </div>

    <!-- Mini Calendar -->
    <div class="p-6 border-b border-themed">
      <!-- Mini Calendar Header -->
      <div class="grid grid-cols-3 items-center mb-4">
        <!-- Previous Button - Fixed left position -->
        <div class="flex justify-start">
          <button 
            (click)="previousMiniMonth()"
            class="p-1 hover:bg-themed-hover rounded transition-colors duration-200">
            <svg class="w-4 h-4 text-themed-primary" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
        
        <!-- Month/Year Title - Always centered -->
        <div class="flex justify-center">
          <h3 class="text-sm font-medium text-themed-primary text-center">{{ miniCalendarMonthYear }}</h3>
        </div>
        
        <!-- Next Button - Fixed right position -->
        <div class="flex justify-end">
          <button 
            (click)="nextMiniMonth()"
            class="p-1 hover:bg-themed-hover rounded transition-colors duration-200">
            <svg class="w-4 h-4 text-themed-primary" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
      </div>
      
      <div class="mini-calendar">
        <!-- Week days header -->
        <div class="grid grid-cols-7 gap-1 text-xs mb-2">
          <div class="text-center text-themed-muted p-1 font-medium" *ngFor="let day of weekDays">{{ day }}</div>
        </div>
        
        <!-- Calendar dates -->
        <div class="grid grid-cols-7 gap-1">
          <button 
            *ngFor="let date of miniCalendarDates" 
            class="mini-date-btn relative"
            [class.today]="date.isToday"
            [class.other-month]="!date.isCurrentMonth"
            [class.selected]="date.isSelected"
            (click)="navigateToDate(date.date)">
            {{ date.day }}
            <div 
              *ngIf="date.hasEvents" 
              class="absolute bottom-1 right-1 w-2 h-2 bg-primary-adaptive rounded-full opacity-80"></div>
          </button>
        </div>
      </div>
    </div>

    <!-- My Calendars -->
    <div class="p-6 flex-1 overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <div class="text-sm font-medium text-themed-primary">My calendars</div>
        <button 
          (click)="openCategoryModal()"
          class="text-xs text-themed-muted hover:text-primary-adaptive transition-colors">
          + Add
        </button>
      </div>
      
      <div class="space-y-3">
        <div 
          *ngFor="let category of categories; trackBy: trackByCategory" 
          class="flex items-center justify-between group category-list-item">
          <div class="flex items-center space-x-3 flex-1 min-w-0">
            <button 
              (click)="toggleCategoryVisibility(category.id)"
              class="flex items-center space-x-3 flex-1 p-1 rounded hover:bg-themed-hover transition-colors text-left min-w-0"
              [attr.aria-label]="'Toggle ' + category.name + ' visibility'">
              <div 
                class="w-3 h-3 rounded-full flex-shrink-0"
                [style.background-color]="category.color"
                [class.opacity-50]="!visibleCategories.has(category.id)"></div>
              <span 
                class="text-sm flex-1 text-left truncate"
                [class.text-themed-primary]="visibleCategories.has(category.id)"
                [class.text-themed-muted]="!visibleCategories.has(category.id)">
                {{ category.icon }} {{ category.name }}
              </span>
            </button>
          </div>
          <button 
            (click)="deleteCategory(category.id); $event.stopPropagation()"
            class="opacity-0 group-hover:opacity-100 text-xs text-themed-muted hover:text-danger transition-opacity p-2 flex-shrink-0 category-delete-btn"
            [attr.aria-label]="'Delete ' + category.name">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Fivex Labs Branding -->
    <div class="border-t border-themed">
      <div class="p-4">
        <div class="flex items-center space-x-3 mb-3">
          <img 
            src="images/logos/icon-logo-square.jpeg" 
            alt="Fivex Labs Logo" 
            class="w-8 h-8 rounded-lg border-2 border-themed-primary shadow-sm">
          <div class="flex-1">
            <div class="text-xs font-semibold text-themed-primary mb-1">Fivex Labs</div>
            <div class="flex items-center space-x-1 text-xs text-themed-muted">
              <span>Made with</span>
              <svg class="w-3 h-3 text-red-500 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
              </svg>
              <span>by</span>
              <a class="underline text-primary-adaptive cursor-pointer hover:text-primary-adaptive transition-colors" href="https://fivexlabs.com" target="_blank" rel="noopener noreferrer">Fivex Labs</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Calendar Area -->
  <div class="flex-1 flex flex-col bg-themed-surface">
    <!-- Top Header -->
    <div class="h-16 border-b border-themed flex items-center justify-between px-6">
      <div class="flex items-center space-x-4">
        <!-- Navigation buttons first -->
        <div class="flex items-center space-x-2">
          <button 
            (click)="previousMonth()"
            class="p-2 hover:bg-themed-hover rounded-full transition-colors duration-200">
            <svg class="w-5 h-5 text-themed-primary" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
            </svg>
          </button>
          <button 
            (click)="nextMonth()"
            class="p-2 hover:bg-themed-hover rounded-full transition-colors duration-200">
            <svg class="w-5 h-5 text-themed-primary" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
            </svg>
          </button>
          <button 
            (click)="todayView()"
            class="px-4 py-2 text-sm text-themed-primary hover:bg-themed-hover rounded transition-colors duration-200">
            Today
          </button>
        </div>
        
        <!-- Month/Year title after navigation -->
        <h1 class="text-2xl font-normal text-themed-primary">{{ currentMonthYear }}</h1>
      </div>

      <div class="flex items-center space-x-4">
        <!-- GitHub Repository Link -->
        <a 
          href="https://github.com/Fivex-Labs/schedular-fullstack" 
          target="_blank" 
          rel="noopener noreferrer"
          class="flex items-center space-x-2 px-3 py-2 text-sm text-themed-primary hover:text-primary-adaptive hover:bg-themed-hover rounded-lg transition-all duration-200 group"
          title="View source code on GitHub">
          <svg class="w-5 h-5 group-hover:scale-110 transition-transform duration-200" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
          </svg>
          <span class="hidden sm:inline font-medium">GitHub</span>
        </a>

        <!-- Theme Toggle Button -->
        <button 
          (click)="toggleTheme()"
          class="p-2 hover:bg-themed-hover rounded-full transition-all duration-200 text-themed-primary hover:text-primary-adaptive"
          [title]="isDarkTheme ? 'Switch to light mode' : 'Switch to dark mode'">
          <svg *ngIf="isDarkTheme" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <!-- Sun icon for dark theme (to switch to light) -->
            <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
          </svg>
          <svg *ngIf="!isDarkTheme" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <!-- Moon icon for light theme (to switch to dark) -->
            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
          </svg>
        </button>

        <!-- View Toggle -->
        <div class="flex border border-themed rounded-lg overflow-hidden">
          <button 
            (click)="changeView('dayGridMonth')"
            [class.active]="currentView === 'dayGridMonth'"
            class="px-4 py-2 text-sm text-themed-primary hover:bg-themed-hover transition-colors duration-200">
            Month
          </button>
          <button 
            (click)="changeView('timeGridWeek')"
            [class.active]="currentView === 'timeGridWeek'"
            class="px-4 py-2 text-sm text-themed-primary hover:bg-themed-hover transition-colors duration-200 border-l border-themed">
            Week
          </button>
          <button 
            (click)="changeView('timeGridDay')"
            [class.active]="currentView === 'timeGridDay'"
            class="px-4 py-2 text-sm text-themed-primary hover:bg-themed-hover transition-colors duration-200 border-l border-themed">
            Day
          </button>
        </div>
      </div>
    </div>

    <!-- Calendar Container -->
    <div class="flex-1 p-6">
      <div #calendarEl class="h-full calendar-container"></div>
    </div>
  </div>
</div>

<!-- Create Event Modal -->
<div 
  *ngIf="showCreateModal" 
  class="fixed inset-0 flex items-center justify-center z-50"
  style="background-color: var(--color-modal-backdrop)"
  (click)="closeCreateEventModal()">
  <div 
    class="bg-themed-surface border border-themed rounded-xl p-6 w-[500px] max-w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto"
    (click)="$event.stopPropagation()">
    <h3 class="text-xl font-semibold text-themed-primary mb-6">
      {{ isEditingEvent ? 'Edit Event' : 'Create Event' }}
    </h3>
    
    <form (ngSubmit)="createEvent()" #eventForm="ngForm">
      <div class="space-y-6">
        <!-- Basic Information -->
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-themed-primary mb-2">Title</label>
            <input 
              type="text" 
              [(ngModel)]="newEvent.title" 
              name="title"
              required
              placeholder="Enter event title"
              class="w-full bg-themed-surface border border-themed rounded-lg px-3 py-2 text-themed-primary focus:border-primary focus:outline-none">
          </div>
          
          <div>
            <label class="block text-sm font-medium text-themed-primary mb-2">Description</label>
            <textarea 
              [(ngModel)]="newEvent.description" 
              name="description"
              rows="3"
              placeholder="Add a description (optional)"
              class="w-full bg-themed-surface border border-themed rounded-lg px-3 py-2 text-themed-primary focus:border-primary focus:outline-none resize-none"></textarea>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-themed-primary mb-2">Location</label>
            <input 
              type="text" 
              [(ngModel)]="newEvent.location" 
              name="location"
              placeholder="Add location (optional)"
              class="w-full bg-themed-surface border border-themed rounded-lg px-3 py-2 text-themed-primary focus:border-primary focus:outline-none">
          </div>
        </div>

        <!-- Date and Time -->
        <div class="border-t border-themed pt-6">
          <div class="flex items-center space-x-2 mb-4">
            <svg class="w-4 h-4 text-primary-adaptive" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
            </svg>
            <h4 class="text-sm font-medium text-themed-primary">Date & Time</h4>
          </div>
          
          <div class="space-y-5">
            <!-- Date Input -->
            <div class="date-input-wrapper">
              <label class="block text-sm font-medium text-themed-primary mb-2">Date</label>
              <div class="date-input-container">
                <input 
                  #dateInput
                  type="date" 
                  [(ngModel)]="newEvent.date" 
                  name="date"
                  required
                  class="date-input">
                <div class="date-input-icon" (click)="dateInput.showPicker()">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                  </svg>
                </div>
              </div>
            </div>
            
            <!-- All Day Toggle -->
            <div class="all-day-toggle-wrapper">
              <div class="flex items-center justify-between p-4 rounded-lg border border-themed bg-themed-surface/30 hover:bg-themed-hover/30 transition-all duration-200">
                <div class="flex items-center space-x-3">
                  <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center">
                    <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                    </svg>
                  </div>
                  <div>
                    <div class="text-sm font-medium text-themed-primary">All day event</div>
                    <div class="text-xs text-themed-muted">Event lasts the entire day</div>
                  </div>
                </div>
                
                <!-- Custom Toggle Switch -->
                <div class="all-day-toggle">
                  <input 
                    type="checkbox" 
                    [(ngModel)]="newEvent.allDay" 
                    name="allDay"
                    id="allDay"
                    class="all-day-checkbox">
                  <label for="allDay" class="all-day-toggle-label">
                    <span class="all-day-toggle-slider"></span>
                  </label>
                </div>
              </div>
            </div>
            
            <!-- Time Inputs -->
            <div *ngIf="!newEvent.allDay" class="time-inputs-container">
              <h5 class="text-xs font-medium text-themed-muted mb-3 uppercase tracking-wide">Time Schedule</h5>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Start Time -->
                <div class="time-input-card start-time">
                  <div class="time-input-header">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Start Time</span>
                  </div>
                  <div class="time-input-wrapper">
                    <input 
                      #startTimeInput
                      type="time" 
                      [(ngModel)]="newEvent.startTime" 
                      name="startTime"
                      (ngModelChange)="onTimeChange()"
                      class="time-input"
                      [class.error]="hasTimeValidationError()">
                    <div class="time-input-icon" (click)="startTimeInput.showPicker()">
                      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                  </div>
                </div>
                
                <!-- End Time -->
                <div class="time-input-card end-time">
                  <div class="time-input-header">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.798 7.45c.512-.67 1.135-.95 1.702-.95s1.19.28 1.702.95a.75.75 0 001.192-.91C12.637 5.55 11.596 5 10.5 5s-2.137.55-2.894 1.54a.75.75 0 001.192.91z" clip-rule="evenodd"></path>
                    </svg>
                    <span>End Time</span>
                  </div>
                  <div class="time-input-wrapper">
                    <input 
                      #endTimeInput
                      type="time" 
                      [(ngModel)]="newEvent.endTime" 
                      name="endTime"
                      (ngModelChange)="onTimeChange()"
                      class="time-input"
                      [class.error]="hasTimeValidationError()">
                    <div class="time-input-icon" (click)="endTimeInput.showPicker()">
                      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.798 7.45c.512-.67 1.135-.95 1.702-.95s1.19.28 1.702.95a.75.75 0 001.192-.91C12.637 5.55 11.596 5 10.5 5s-2.137.55-2.894 1.54a.75.75 0 001.192.91z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Duration Display & Validation Messages -->
              <div *ngIf="newEvent.startTime && newEvent.endTime" class="mt-4 space-y-3">
                <!-- Valid Duration Display -->
                <div *ngIf="isValidTimeRange()" class="duration-display">
                  <div class="flex items-center space-x-2">
                    <svg class="w-4 h-4 text-primary-adaptive" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="text-sm font-medium text-primary-adaptive">
                      Duration: {{ calculateDuration(newEvent.startTime, newEvent.endTime) }}
                    </span>
                    <div *ngIf="isMinimumDuration()" class="inline-flex items-center px-2 py-1 rounded-full bg-green-500/10 text-green-600">
                      <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                      </svg>
                      <span class="text-xs font-medium">Valid</span>
                    </div>
                  </div>
                </div>
                
                <!-- Error Messages -->
                <div *ngIf="!isValidTimeRange() || !isMinimumDuration()" class="space-y-2">
                  <!-- Negative Duration Error -->
                  <div *ngIf="hasNegativeDuration()" class="validation-error">
                    <div class="flex items-start space-x-2">
                      <svg class="w-4 h-4 text-danger flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                      </svg>
                      <div class="flex-1">
                        <p class="text-sm font-medium text-danger">Invalid time range</p>
                        <p class="text-xs text-danger/80">End time cannot be before or same as start time. Please adjust your times.</p>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Too Short Duration Warning -->
                  <div *ngIf="isValidTimeRange() && !isMinimumDuration()" class="validation-warning">
                    <div class="flex items-start space-x-2">
                      <svg class="w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                      </svg>
                      <div class="flex-1">
                        <p class="text-sm font-medium text-orange-600">Very short event</p>
                        <p class="text-xs text-orange-600/80">Event duration is less than 1 minute. Consider extending the time for better scheduling.</p>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Helpful Suggestions -->
                <div *ngIf="newEvent.startTime && !newEvent.endTime" class="helpful-suggestion">
                  <div class="flex items-center space-x-2 text-themed-muted">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="text-xs">Set an end time to specify event duration</span>
                  </div>
                </div>
                
                <!-- Quick Duration Buttons -->
                <div *ngIf="newEvent.startTime && isValidTimeRange() && isMinimumDuration()" class="quick-duration-buttons">
                  <div class="flex items-center space-x-2">
                    <span class="text-xs text-themed-muted">Quick extend:</span>
                    <button 
                      type="button"
                      (click)="extendDuration(30)"
                      class="quick-duration-btn">
                      +30m
                    </button>
                    <button 
                      type="button"
                      (click)="extendDuration(60)"
                      class="quick-duration-btn">
                      +1h
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Category -->
        <div class="border-t border-themed pt-6">
          <button 
            type="button"
            (click)="toggleCategorySection()"
            class="w-full flex items-center justify-between p-3 rounded-lg hover:bg-themed-hover transition-all duration-200 group">
            <div class="flex items-center space-x-3">
              <div class="w-8 h-8 bg-purple-500/10 rounded-lg flex items-center justify-center group-hover:bg-purple-500/20 transition-colors">
                <svg class="w-4 h-4 text-purple-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <div class="text-left">
                <h4 class="text-sm font-medium text-themed-primary">Category</h4>
                <p class="text-xs text-themed-muted">Organize your event</p>
              </div>
            </div>
            <svg 
              class="w-5 h-5 text-themed-muted transition-transform duration-200"
              [class.rotate-180]="showCategorySection"
              fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
          
          <div *ngIf="showCategorySection" class="mt-4 space-y-4">
            <select 
              [(ngModel)]="newEvent.categoryId" 
              name="categoryId"
              class="w-full bg-themed-surface border border-themed rounded-lg px-3 py-2 text-themed-primary focus:border-primary focus:outline-none">
              <option value="">Select a category</option>
              <option *ngFor="let category of categories" [value]="category.id">
                {{ category.icon }} {{ category.name }}
              </option>
            </select>
          </div>
        </div>

        <!-- Recurrence -->
        <div class="border-t border-themed pt-6">
          <button 
            type="button"
            (click)="toggleRecurrenceSection()"
            class="w-full flex items-center justify-between p-3 rounded-lg hover:bg-themed-hover transition-all duration-200 group">
            <div class="flex items-center space-x-3">
              <div class="w-8 h-8 bg-teal-500/10 rounded-lg flex items-center justify-center group-hover:bg-teal-500/20 transition-colors">
                <svg class="w-4 h-4 text-teal-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <div class="text-left">
                <h4 class="text-sm font-medium text-themed-primary">Repeat</h4>
                <p class="text-xs text-themed-muted">Set recurring schedule</p>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <button 
                *ngIf="newEvent.recurrence"
                type="button"
                (click)="clearRecurrence(); $event.stopPropagation()"
                class="text-sm text-danger hover:text-danger/80 transition-colors px-2 py-1 rounded">
                Clear
              </button>
              <svg 
                class="w-5 h-5 text-themed-muted transition-transform duration-200"
                [class.rotate-180]="showRecurrenceSection"
                fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            </div>
          </button>
          
          <div *ngIf="showRecurrenceSection" class="mt-4 space-y-4">
            <!-- Quick Patterns -->
            <div>
              <h5 class="text-xs font-medium text-themed-muted mb-3 uppercase tracking-wide">Quick Patterns</h5>
              <div class="grid grid-cols-2 gap-3">
                <button 
                  type="button"
                  (click)="setRecurrence('daily')"
                  [class.selected]="newEvent.recurrence?.frequency === 'daily'"
                  class="recurrence-card group">
                  <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center group-hover:bg-blue-500/20 transition-colors">
                      <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    <div class="flex-1 text-left">
                      <div class="text-sm font-medium text-themed-primary">Daily</div>
                      <div class="text-xs text-themed-muted">Every day</div>
                    </div>
                  </div>
                </button>
                
                <button 
                  type="button"
                  (click)="setRecurrence('weekly')"
                  [class.selected]="newEvent.recurrence?.frequency === 'weekly'"
                  class="recurrence-card group">
                  <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-green-500/10 rounded-lg flex items-center justify-center group-hover:bg-green-500/20 transition-colors">
                      <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    <div class="flex-1 text-left">
                      <div class="text-sm font-medium text-themed-primary">Weekly</div>
                      <div class="text-xs text-themed-muted">Every week</div>
                    </div>
                  </div>
                </button>
                
                <button 
                  type="button"
                  (click)="setRecurrence('monthly')"
                  [class.selected]="newEvent.recurrence?.frequency === 'monthly'"
                  class="recurrence-card group">
                  <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-purple-500/10 rounded-lg flex items-center justify-center group-hover:bg-purple-500/20 transition-colors">
                      <svg class="w-4 h-4 text-purple-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    <div class="flex-1 text-left">
                      <div class="text-sm font-medium text-themed-primary">Monthly</div>
                      <div class="text-xs text-themed-muted">Every month</div>
                    </div>
                  </div>
                </button>
                
                <button 
                  type="button"
                  (click)="setRecurrence('yearly')"
                  [class.selected]="newEvent.recurrence?.frequency === 'yearly'"
                  class="recurrence-card group">
                  <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-orange-500/10 rounded-lg flex items-center justify-center group-hover:bg-orange-500/20 transition-colors">
                      <svg class="w-4 h-4 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    <div class="flex-1 text-left">
                      <div class="text-sm font-medium text-themed-primary">Yearly</div>
                      <div class="text-xs text-themed-muted">Every year</div>
                    </div>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- Work Patterns -->
            <div>
              <h5 class="text-xs font-medium text-themed-muted mb-3 uppercase tracking-wide">Work Patterns</h5>
              <div class="grid grid-cols-2 gap-3">
                <button 
                  type="button"
                  (click)="setRecurrence('weekdays')"
                  [class.selected]="newEvent.recurrence?.frequency === 'weekly' && newEvent.recurrence?.daysOfWeek?.join(',') === '1,2,3,4,5'"
                  class="recurrence-card group">
                  <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-indigo-500/10 rounded-lg flex items-center justify-center group-hover:bg-indigo-500/20 transition-colors">
                      <svg class="w-4 h-4 text-indigo-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6 6V5a3 3 0 013-3h2a3 3 0 013 3v1h2a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h2zm-1 4a1 1 0 112 0v4a1 1 0 11-2 0v-4zm8 0a1 1 0 10-2 0v4a1 1 0 102 0v-4zm1-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v4h4z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    <div class="flex-1 text-left">
                      <div class="text-sm font-medium text-themed-primary">Weekdays</div>
                      <div class="text-xs text-themed-muted">Mon - Fri</div>
                    </div>
                  </div>
                </button>
                
                <button 
                  type="button"
                  (click)="setRecurrence('weekends')"
                  [class.selected]="newEvent.recurrence?.frequency === 'weekly' && newEvent.recurrence?.daysOfWeek?.join(',') === '6,0'"
                  class="recurrence-card group">
                  <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-pink-500/10 rounded-lg flex items-center justify-center group-hover:bg-pink-500/20 transition-colors">
                      <svg class="w-4 h-4 text-pink-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    <div class="flex-1 text-left">
                      <div class="text-sm font-medium text-themed-primary">Weekends</div>
                      <div class="text-xs text-themed-muted">Sat - Sun</div>
                    </div>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- Custom Intervals -->
            <div>
              <h5 class="text-xs font-medium text-themed-muted mb-3 uppercase tracking-wide">Custom Intervals</h5>
              <div class="grid grid-cols-2 gap-3">
                <button 
                  type="button"
                  (click)="setRecurrence('biweekly')"
                  [class.selected]="newEvent.recurrence?.frequency === 'weekly' && newEvent.recurrence?.interval === 2"
                  class="recurrence-card group">
                  <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-teal-500/10 rounded-lg flex items-center justify-center group-hover:bg-teal-500/20 transition-colors">
                      <svg class="w-4 h-4 text-teal-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    <div class="flex-1 text-left">
                      <div class="text-sm font-medium text-themed-primary">Every 2 weeks</div>
                      <div class="text-xs text-themed-muted">Biweekly</div>
                    </div>
                  </div>
                </button>
                
                <button 
                  type="button"
                  (click)="setRecurrence('quarterly')"
                  [class.selected]="newEvent.recurrence?.frequency === 'monthly' && newEvent.recurrence?.interval === 3"
                  class="recurrence-card group">
                  <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-amber-500/10 rounded-lg flex items-center justify-center group-hover:bg-amber-500/20 transition-colors">
                      <svg class="w-4 h-4 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2H6zm1 2a1 1 0 000 2h6a1 1 0 100-2H7zm6 7a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1zm-3 3a1 1 0 100 2h.01a1 1 0 100-2H10zm-4 1a1 1 0 011-1h.01a1 1 0 110 2H7a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    <div class="flex-1 text-left">
                      <div class="text-sm font-medium text-themed-primary">Every 3 months</div>
                      <div class="text-xs text-themed-muted">Quarterly</div>
                    </div>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- Custom Day Selector -->
            <div *ngIf="showCustomDaySelector" class="space-y-4">
              <div class="flex items-center justify-between">
                <h5 class="text-xs font-medium text-themed-muted uppercase tracking-wide">Choose Days</h5>
                <div class="flex space-x-2">
                  <button 
                    type="button"
                    (click)="selectAllWeekdays()"
                    class="text-xs px-2 py-1 bg-primary-adaptive/10 text-primary-adaptive rounded hover:bg-primary-adaptive/20 transition-colors">
                    Weekdays
                  </button>
                  <button 
                    type="button"
                    (click)="selectAllWeekends()"
                    class="text-xs px-2 py-1 bg-purple-500/10 text-purple-500 rounded hover:bg-purple-500/20 transition-colors">
                    Weekends
                  </button>
                  <button 
                    type="button"
                    (click)="clearDaySelection()"
                    class="text-xs px-2 py-1 bg-themed-secondary/10 text-themed-secondary rounded hover:bg-themed-secondary/20 transition-colors">
                    Clear
                  </button>
                </div>
              </div>
              
              <div class="grid grid-cols-7 gap-2">
                <button 
                  *ngFor="let dayInfo of weekDayLabels"
                  type="button"
                  (click)="toggleDayOfWeek(dayInfo.day)"
                  [class.selected]="isDaySelected(dayInfo.day)"
                  class="day-selector-btn group">
                  <div class="text-center">
                    <div class="text-xs font-medium text-themed-primary group-hover:text-white transition-colors">
                      {{ dayInfo.label }}
                    </div>
                    <div class="text-xs text-themed-muted group-hover:text-white/80 transition-colors mt-1">
                      {{ dayInfo.fullName.substring(0, 3) }}
                    </div>
                  </div>
                </button>
              </div>
              
              <div *ngIf="selectedDaysOfWeek.size > 0" class="text-xs text-themed-secondary">
                <span class="font-medium">Selected days:</span>
                <span class="ml-1">
                  {{ getSelectedDayLabels() }}
                </span>
              </div>
            </div>
            
            <!-- Recurrence Summary -->
            <div *ngIf="newEvent.recurrence" class="mt-4 p-3 bg-primary-adaptive/5 border border-primary-adaptive/20 rounded-lg">
              <div class="flex items-center space-x-2">
                <svg class="w-4 h-4 text-primary-adaptive" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                </svg>
                <span class="text-sm font-medium text-primary-adaptive">{{ getRecurrenceDescription(newEvent.recurrence) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Notifications -->
        <div class="border-t border-themed pt-6">
          <button 
            type="button"
            (click)="toggleNotificationsSection()"
            class="w-full flex items-center justify-between p-3 rounded-lg hover:bg-themed-hover transition-all duration-200 group">
            <div class="flex items-center space-x-3">
              <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center group-hover:bg-blue-500/20 transition-colors">
                <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path>
                </svg>
              </div>
              <div class="text-left">
                <div class="flex items-center space-x-2">
                  <h4 class="text-sm font-medium text-themed-primary">Notifications</h4>
                  <div *ngIf="newEvent.notifications.length > 0" class="inline-flex items-center px-2 py-0.5 rounded-full bg-primary-adaptive/10 text-primary-adaptive">
                    <span class="text-xs font-medium">{{ newEvent.notifications.length }}</span>
                  </div>
                </div>
                <p class="text-xs text-themed-muted">Set event reminders</p>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <button 
                type="button"
                (click)="addNotification(); $event.stopPropagation()"
                class="text-sm text-primary-adaptive hover:text-primary-adaptive/80 transition-colors font-medium px-2 py-1 rounded">
                + Add
              </button>
              <svg 
                class="w-5 h-5 text-themed-muted transition-transform duration-200"
                [class.rotate-180]="showNotificationsSection"
                fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            </div>
          </button>
          
          <div *ngIf="showNotificationsSection" class="mt-4 space-y-4">
            <!-- Empty State -->
            <div *ngIf="newEvent.notifications.length === 0" class="text-center py-8 bg-themed-hover rounded-lg border border-themed">
              <div class="w-12 h-12 bg-primary-adaptive/10 rounded-full flex items-center justify-center mx-auto mb-3">
                <svg class="w-6 h-6 text-primary-adaptive" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path>
                </svg>
              </div>
              <p class="text-sm text-themed-muted mb-2">No reminders set</p>
              <p class="text-xs text-themed-muted">Get notified before your event starts</p>
            </div>
            
            <!-- Quick Add Options -->
            <div *ngIf="newEvent.notifications.length === 0" class="mt-4">
              <h5 class="text-xs font-medium text-themed-muted mb-3 uppercase tracking-wide">Quick Add</h5>
              <div class="grid grid-cols-2 gap-2">
                <button 
                  type="button"
                  (click)="addQuickNotification(15)"
                  class="notification-quick-btn">
                  <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                  </svg>
                  <span class="text-sm">15 minutes</span>
                </button>
                
                <button 
                  type="button"
                  (click)="addQuickNotification(60)"
                  class="notification-quick-btn">
                  <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                  </svg>
                  <span class="text-sm">1 hour</span>
                </button>
              </div>
            </div>
            
            <!-- Notification Cards -->
            <div *ngIf="newEvent.notifications.length > 0" class="space-y-3">
              <div 
                *ngFor="let notification of newEvent.notifications; let i = index" 
                class="notification-card">
                <div class="flex items-center space-x-4">
                  <!-- Custom Checkbox -->
                  <div class="notification-checkbox-wrapper">
                    <input 
                      type="checkbox" 
                      [(ngModel)]="notification.isEnabled" 
                      [name]="'notification-enabled-' + i"
                      [id]="'notification-' + i"
                      class="notification-checkbox">
                    <label 
                      [for]="'notification-' + i" 
                      class="notification-checkbox-label">
                      <svg class="w-3 h-3 notification-checkbox-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                      </svg>
                    </label>
                  </div>
                  
                  <!-- Notification Info -->
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center space-x-2 mb-1">
                      <svg class="w-4 h-4 flex-shrink-0" 
                           [class.text-primary-adaptive]="notification.isEnabled"
                           [class.text-themed-muted]="!notification.isEnabled"
                           fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path>
                      </svg>
                      <span class="text-sm font-medium" 
                            [class.text-themed-primary]="notification.isEnabled"
                            [class.text-themed-muted]="!notification.isEnabled">
                        Reminder
                      </span>
                    </div>
                    
                    <div class="notification-timing-wrapper">
                      <select 
                        [(ngModel)]="notification.timing" 
                        [name]="'notification-timing-' + i"
                        class="notification-timing-select"
                        [class.enabled]="notification.isEnabled"
                        [class.disabled]="!notification.isEnabled">
                        <option *ngFor="let preset of notificationPresets" [value]="preset.timing">
                          {{ preset.label }}
                        </option>
                      </select>
                      <svg class="notification-select-arrow" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    
                    <p class="text-xs mt-1" 
                       [class.text-primary-adaptive]="notification.isEnabled"
                       [class.text-themed-muted]="!notification.isEnabled">
                      {{ getTimingDescription(notification.timing) }}
                    </p>
                  </div>
                  
                  <!-- Delete Button -->
                  <button 
                    type="button"
                    (click)="removeNotification(i)"
                    class="notification-delete-btn">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                  </button>
                </div>
              </div>
              
              <!-- Add More Button -->
              <button 
                type="button"
                (click)="addNotification()"
                class="notification-add-more-btn">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                </svg>
                <span>Add another reminder</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Participants -->
        <div class="border-t border-themed pt-6">
          <button 
            type="button"
            (click)="toggleParticipantsSection()"
            class="w-full flex items-center justify-between p-3 rounded-lg hover:bg-themed-hover transition-all duration-200 group">
            <div class="flex items-center space-x-3">
              <div class="w-8 h-8 bg-indigo-500/10 rounded-lg flex items-center justify-center group-hover:bg-indigo-500/20 transition-colors">
                <svg class="w-4 h-4 text-indigo-500" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                </svg>
              </div>
              <div class="text-left">
                <div class="flex items-center space-x-2">
                  <h4 class="text-sm font-medium text-themed-primary">Participants</h4>
                  <div *ngIf="newEvent.participants.length > 0" class="inline-flex items-center px-2 py-0.5 rounded-full bg-indigo-500/10 text-indigo-500">
                    <span class="text-xs font-medium">{{ newEvent.participants.length }}</span>
                  </div>
                </div>
                <p class="text-xs text-themed-muted">Add people to your event</p>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <button 
                type="button"
                (click)="newEvent.participants = []; $event.stopPropagation()"
                *ngIf="newEvent.participants.length > 0"
                class="text-sm text-danger hover:text-danger/80 transition-colors font-medium px-2 py-1 rounded">
                Clear All
              </button>
              <svg 
                class="w-5 h-5 text-themed-muted transition-transform duration-200"
                [class.rotate-180]="showParticipantsSection"
                fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            </div>
          </button>
          
          <div *ngIf="showParticipantsSection" class="mt-4 space-y-4">
            <!-- Search Box -->
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg class="w-4 h-4 text-themed-muted" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <input 
                type="text" 
                [(ngModel)]="participantSearchQuery"
                (ngModelChange)="onParticipantSearch()"
                name="participantSearch"
                placeholder="Search participants..."
                class="w-full pl-10 pr-4 py-2 bg-themed-surface border border-themed rounded-lg text-themed-primary focus:border-primary focus:outline-none text-sm">
            </div>

            <!-- Selected Participants -->
            <div *ngIf="getSelectedParticipants().length > 0" class="space-y-2">
              <h5 class="text-xs font-medium text-themed-muted uppercase tracking-wide">Selected</h5>
              <div class="space-y-2">
                <div 
                  *ngFor="let participant of getSelectedParticipants()" 
                  class="flex items-center justify-between p-2 bg-indigo-500/5 border border-indigo-500/20 rounded-lg">
                  <div class="flex items-center space-x-2">
                    <img 
                      [src]="participant.avatar" 
                      [alt]="participant.name"
                      class="w-6 h-6 rounded-full">
                    <span class="text-sm text-themed-primary">{{ participant.name }}</span>
                  </div>
                  <button 
                    type="button"
                    (click)="removeParticipant(participant.id)"
                    class="p-1 text-themed-muted hover:text-danger transition-colors rounded">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Available Participants -->
            <div class="space-y-2">
              <h5 class="text-xs font-medium text-themed-muted uppercase tracking-wide">Available</h5>
              <div class="max-h-48 overflow-y-auto space-y-1">
                <div 
                  *ngFor="let participant of filteredParticipants" 
                  class="flex items-center justify-between p-2 hover:bg-themed-hover border border-themed rounded-lg transition-all duration-200 cursor-pointer"
                  [class.opacity-50]="isParticipantSelected(participant.id)"
                  (click)="!isParticipantSelected(participant.id) && addParticipant(participant.id)">
                  <div class="flex items-center space-x-2">
                    <img 
                      [src]="participant.avatar" 
                      [alt]="participant.name"
                      class="w-6 h-6 rounded-full">
                    <div>
                      <p class="text-sm text-themed-primary">{{ participant.name }}</p>
                      <p class="text-xs text-themed-muted">{{ participant.role }}</p>
                    </div>
                  </div>
                  <svg 
                    *ngIf="!isParticipantSelected(participant.id)"
                    class="w-4 h-4 text-themed-muted" 
                    fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex justify-end space-x-3 mt-8 pt-6 border-t border-themed">
        <button 
          type="button"
          (click)="closeCreateEventModal()"
          class="px-6 py-2 text-sm text-themed-primary hover:bg-themed-hover rounded-lg transition-colors duration-200">
          Cancel
        </button>
        <button 
          type="submit" 
          [disabled]="!eventForm.form.valid || (!newEvent.allDay && hasTimeValidationError())"
          class="px-6 py-2 text-sm bg-primary-adaptive text-dark rounded-lg font-semibold hover:bg-primary-adaptive/90 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
          {{ isEditingEvent ? 'Update Event' : 'Create Event' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Create Category Modal -->
<div 
  *ngIf="showCategoryModal" 
  class="fixed inset-0 flex items-center justify-center z-50"
  style="background-color: var(--color-modal-backdrop)"
  (click)="closeCategoryModal()">
  <div 
    class="bg-themed-surface border border-themed rounded-xl p-6 w-96 max-w-full mx-4 shadow-2xl"
    (click)="$event.stopPropagation()">
    <h3 class="text-xl font-semibold text-themed-primary mb-6">Create Category</h3>
    
    <form (ngSubmit)="createCategory()" #categoryForm="ngForm">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-themed-primary mb-2">Name</label>
          <input 
            type="text" 
            [(ngModel)]="newCategory.name" 
            name="name"
            required
            placeholder="Enter category name"
            class="w-full bg-themed-surface border border-themed rounded-lg px-3 py-2 text-themed-primary focus:border-primary focus:outline-none">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-themed-primary mb-2">Icon</label>
          <input 
            type="text" 
            [(ngModel)]="newCategory.icon" 
            name="icon"
            placeholder="📅"
            class="w-full bg-themed-surface border border-themed rounded-lg px-3 py-2 text-themed-primary focus:border-primary focus:outline-none">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-themed-primary mb-2">Color</label>
          <div class="grid grid-cols-6 gap-2 mt-2">
            <button 
              type="button"
              *ngFor="let color of ['#dcff00', '#c58fff', '#2dd55b', '#ffc409', '#c5000f', '#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#6c5ce7', '#9ca3af']" 
              [class]="'w-8 h-8 rounded-lg border-2 ' + (newCategory.color === color ? 'border-themed-primary' : 'border-transparent')"
              [style.background-color]="color"
              (click)="newCategory.color = color">
            </button>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-themed-primary mb-2">Description</label>
          <textarea 
            [(ngModel)]="newCategory.description" 
            name="description"
            rows="3"
            placeholder="Add a description (optional)"
            class="w-full bg-themed-surface border border-themed rounded-lg px-3 py-2 text-themed-primary focus:border-primary focus:outline-none resize-none"></textarea>
        </div>
      </div>
      
      <div class="flex justify-end space-x-3 mt-6">
        <button 
          type="button" 
          (click)="closeCategoryModal()"
          class="px-4 py-2 text-sm text-themed-primary hover:bg-themed-hover rounded transition-colors duration-200">
          Cancel
        </button>
        <button 
          type="submit" 
          class="px-4 py-2 text-sm bg-primary-adaptive text-dark rounded font-semibold hover:bg-primary-adaptive/90 transition-colors duration-200">
          Create
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Category Confirmation Modal -->
<div 
  *ngIf="showDeleteConfirmModal" 
  class="fixed inset-0 flex items-center justify-center z-50"
  style="background-color: var(--color-modal-backdrop)"
  (click)="closeDeleteConfirmModal()">
  <div 
    class="bg-themed-surface border border-themed rounded-xl p-6 w-96 max-w-full mx-4 shadow-2xl"
    (click)="$event.stopPropagation()">
    
    <!-- Header with Warning Icon -->
    <div class="flex items-center space-x-3 mb-4">
      <div class="w-10 h-10 bg-danger/10 rounded-full flex items-center justify-center flex-shrink-0">
        <svg class="w-5 h-5 text-danger" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-semibold text-themed-primary">Delete Category</h3>
        <p class="text-sm text-themed-muted">This action cannot be undone</p>
      </div>
    </div>
    
    <!-- Category Info -->
    <div *ngIf="categoryToDelete" class="bg-themed-hover rounded-lg p-4 mb-6">
      <div class="flex items-center space-x-3">
        <div 
          class="w-4 h-4 rounded-full flex-shrink-0"
          [style.background-color]="categoryToDelete.color"></div>
        <div class="flex-1">
          <div class="text-sm font-medium text-themed-primary">
            {{ categoryToDelete.icon }} {{ categoryToDelete.name }}
          </div>
          <div class="text-xs text-themed-muted mt-1">
            {{ categoryToDelete.description || 'No description' }}
          </div>
        </div>
      </div>
    </div>
    
    <!-- Warning Message -->
    <div class="mb-6">
      <p class="text-sm text-themed-primary">
        Are you sure you want to delete this category? 
        <span class="font-medium">Events in this category will not be deleted</span> 
        but will no longer be associated with any category.
      </p>
    </div>
    
    <!-- Action Buttons -->
    <div class="flex justify-end space-x-3">
      <button 
        (click)="closeDeleteConfirmModal()"
        class="px-4 py-2 text-sm text-themed-primary hover:bg-themed-hover rounded-lg transition-colors duration-200">
        Cancel
      </button>
      <button 
        (click)="confirmDeleteCategory()"
        class="px-4 py-2 text-sm bg-danger text-white rounded-lg font-semibold hover:bg-danger/90 transition-colors duration-200">
        Delete Category
      </button>
    </div>
  </div>
</div>

<!-- Event Details Modal -->
<div 
  *ngIf="showEventDetailsModal && selectedEvent" 
  class="fixed inset-0 flex items-center justify-center z-50"
  style="background-color: var(--color-modal-backdrop)"
  (click)="closeEventDetailsModal()">
  <div 
    class="bg-themed-surface border border-themed rounded-xl p-6 w-[500px] max-w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto"
    (click)="$event.stopPropagation()">
    
    <!-- Header -->
    <div class="flex items-start justify-between mb-6">
      <div class="flex-1 min-w-0">
        <h3 class="text-xl font-semibold text-themed-primary mb-2 break-words">
          {{ selectedEvent.title }}
        </h3>
        <div class="text-sm text-themed-muted">
          {{ getEventDateTimeDisplay() }}
        </div>
      </div>
      <button 
        (click)="closeEventDetailsModal()"
        class="ml-4 p-2 text-themed-muted hover:text-themed-primary hover:bg-themed-hover rounded-lg transition-colors flex-shrink-0">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        </svg>
      </button>
    </div>

    <!-- Event Details -->
    <div class="space-y-4 mb-6">
      <!-- Category -->
      <div *ngIf="selectedEvent.categoryId" class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-purple-500/10 rounded-lg flex items-center justify-center">
          <svg class="w-4 h-4 text-purple-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <div>
          <div class="text-sm font-medium text-themed-primary">Category</div>
          <div class="text-sm text-themed-muted">{{ getEventCategoryName() }}</div>
        </div>
      </div>

      <!-- Location -->
      <div *ngIf="selectedEvent.location" class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-green-500/10 rounded-lg flex items-center justify-center">
          <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <div>
          <div class="text-sm font-medium text-themed-primary">Location</div>
          <div class="text-sm text-themed-muted">{{ selectedEvent.location }}</div>
        </div>
      </div>

      <!-- Description -->
      <div *ngIf="selectedEvent.description" class="flex items-start space-x-3">
        <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
          <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm8 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V8z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <div class="flex-1">
          <div class="text-sm font-medium text-themed-primary">Description</div>
          <div class="text-sm text-themed-muted whitespace-pre-wrap">{{ selectedEvent.description }}</div>
        </div>
      </div>

      <!-- Participants -->
      <div *ngIf="selectedEvent.participants && selectedEvent.participants.length > 0" class="flex items-start space-x-3">
        <div class="w-8 h-8 bg-indigo-500/10 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
          <svg class="w-4 h-4 text-indigo-500" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
          </svg>
        </div>
        <div class="flex-1">
          <div class="text-sm font-medium text-themed-primary mb-2">
            Participants ({{ selectedEvent.participants.length }})
          </div>
          <div class="space-y-2">
            <div 
              *ngFor="let participant of selectedEvent.participants" 
              class="flex items-center space-x-2">
              <img 
                [src]="participant.avatar" 
                [alt]="participant.name"
                class="w-6 h-6 rounded-full">
              <span class="text-sm text-themed-muted">{{ participant.name }}</span>
              <span class="text-xs text-themed-muted">({{ participant.role }})</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Recurrence -->
      <div *ngIf="selectedEvent.isRecurring && selectedEvent.recurrence" class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-teal-500/10 rounded-lg flex items-center justify-center">
          <svg class="w-4 h-4 text-teal-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <div>
          <div class="text-sm font-medium text-themed-primary">Recurring Event</div>
          <div class="text-sm text-themed-muted">{{ getRecurrenceDescription(selectedEvent.recurrence) }}</div>
        </div>
      </div>

      <!-- Notifications -->
      <div *ngIf="hasNotifications()" class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-yellow-500/10 rounded-lg flex items-center justify-center">
          <svg class="w-4 h-4 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path>
          </svg>
        </div>
        <div>
          <div class="text-sm font-medium text-themed-primary">Notifications</div>
          <div class="text-sm text-themed-muted">{{ selectedEvent.notifications?.length }} reminder(s) set</div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex justify-end space-x-3 pt-4 border-t border-themed">
      <button 
        (click)="closeEventDetailsModal()"
        class="px-4 py-2 text-sm text-themed-primary hover:bg-themed-hover rounded-lg transition-colors duration-200">
        Close
      </button>
      <button 
        (click)="editSelectedEvent()"
        class="px-4 py-2 text-sm bg-primary-adaptive text-dark rounded-lg font-semibold hover:bg-primary-adaptive/90 transition-colors duration-200">
        Edit Event
      </button>
      <button 
        (click)="initiateDeleteEvent()"
        class="px-4 py-2 text-sm bg-danger text-white rounded-lg font-semibold hover:bg-danger/90 transition-colors duration-200">
        Delete Event
      </button>
    </div>
  </div>
</div>

<!-- Recurring Event Edit Choice Modal -->
<div 
  *ngIf="showRecurringEditChoiceModal" 
  class="fixed inset-0 flex items-center justify-center z-50"
  style="background-color: var(--color-modal-backdrop)"
  (click)="closeRecurringEditChoiceModal()">
  <div 
    class="bg-themed-surface border border-themed rounded-xl p-6 w-96 max-w-full mx-4 shadow-2xl"
    (click)="$event.stopPropagation()">
    
    <div class="flex items-center space-x-3 mb-4">
      <div class="w-10 h-10 bg-teal-500/10 rounded-full flex items-center justify-center">
        <svg class="w-5 h-5 text-teal-500" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <div>
        <h3 class="text-lg font-semibold text-themed-primary">Edit Recurring Event</h3>
        <p class="text-sm text-themed-muted">Choose what to edit</p>
      </div>
    </div>
    
    <div class="space-y-3 mb-6">
      <button 
        (click)="editThisOccurrence()"
        class="w-full p-4 text-left bg-themed-hover hover:bg-themed-hover/80 rounded-lg transition-colors">
        <div class="font-medium text-themed-primary">This event only</div>
        <div class="text-sm text-themed-muted">Edit only this occurrence</div>
      </button>
      
      <button 
        (click)="editEntireSeries()"
        class="w-full p-4 text-left bg-themed-hover hover:bg-themed-hover/80 rounded-lg transition-colors">
        <div class="font-medium text-themed-primary">All events in series</div>
        <div class="text-sm text-themed-muted">Edit all recurring events</div>
      </button>
    </div>
    
    <div class="flex justify-end">
      <button 
        (click)="closeRecurringEditChoiceModal()"
        class="px-4 py-2 text-sm text-themed-primary hover:bg-themed-hover rounded-lg transition-colors duration-200">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- Recurring Event Delete Choice Modal -->
<div 
  *ngIf="showRecurringDeleteChoiceModal" 
  class="fixed inset-0 flex items-center justify-center z-50"
  style="background-color: var(--color-modal-backdrop)"
  (click)="closeRecurringDeleteChoiceModal()">
  <div 
    class="bg-themed-surface border border-themed rounded-xl p-6 w-96 max-w-full mx-4 shadow-2xl"
    (click)="$event.stopPropagation()">
    
    <div class="flex items-center space-x-3 mb-4">
      <div class="w-10 h-10 bg-danger/10 rounded-full flex items-center justify-center">
        <svg class="w-5 h-5 text-danger" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <div>
        <h3 class="text-lg font-semibold text-themed-primary">Delete Recurring Event</h3>
        <p class="text-sm text-themed-muted">Choose what to delete</p>
      </div>
    </div>
    
    <div class="space-y-3 mb-6">
      <button 
        (click)="deleteThisOccurrence()"
        class="w-full p-4 text-left bg-themed-hover hover:bg-themed-hover/80 rounded-lg transition-colors">
        <div class="font-medium text-themed-primary">This event only</div>
        <div class="text-sm text-themed-muted">Delete only this occurrence</div>
      </button>
      
      <button 
        (click)="deleteEntireSeries()"
        class="w-full p-4 text-left bg-themed-hover hover:bg-themed-hover/80 rounded-lg transition-colors">
        <div class="font-medium text-themed-primary">All events in series</div>
        <div class="text-sm text-themed-muted">Delete all recurring events</div>
      </button>
    </div>
    
    <div class="flex justify-end">
      <button 
        (click)="closeRecurringDeleteChoiceModal()"
        class="px-4 py-2 text-sm text-themed-primary hover:bg-themed-hover rounded-lg transition-colors duration-200">
        Cancel
      </button>
    </div>
  </div>
</div> 